DROP DATABASE IF EXISTS DIYLA;

CREATE DATABASE DIYLA;

USE DIYLA;

CREATE TABLE MEMBER
(
    MEM_ID          INT PRIMARY KEY AUTO_INCREMENT,
    MEM_NAME        VARCHAR(30)  NOT NULL,
    MEM_EMAIL       VARCHAR(50)  NOT NULL UNIQUE,
    MEM_PASSWORD    VARCHAR(50)  NOT NULL,
    MEM_PHONE       VARCHAR(10)  NOT NULL,
    MEM_BIRTHDAY    DATE         NOT NULL,
    MEM_GENDER      TINYINT COMMENT '男0,女1',
    MEM_ADDRESS     VARCHAR(100) NOT NULL,
    MEM_STATUS      TINYINT      NOT NULL DEFAULT '0' COMMENT '未驗證0,已驗證1',
    MEM_TOKEN       INT                   DEFAULT '0',
    MEM_DATE        DATE         NOT NULL DEFAULT (CURRENT_DATE),
    BLACKLIST_COM   TINYINT      NOT NULL DEFAULT '0' COMMENT '正常0,停用1',
    BLACKLIST_ART   TINYINT      NOT NULL DEFAULT '0' COMMENT '正常0,停用1',
    BLACKLIST_DIY   TINYINT      NOT NULL DEFAULT '0' COMMENT '正常0,停用1',
    BLACKLIST_CLASS TINYINT      NOT NULL DEFAULT '0' COMMENT '正常0,停用1',
    RPMSG_COUNT     TINYINT               DEFAULT '0'
);

CREATE TABLE COMMODITY_CLASS
(
    COM_CLASS_NO   INT AUTO_INCREMENT COMMENT '商品類別編號'
        PRIMARY KEY,
    COM_CLASS_NAME VARCHAR(50)                         NOT NULL COMMENT '商品類別名稱',
    UPDATE_TIME    TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL ON UPDATE CURRENT_TIMESTAMP COMMENT '更新時間'
)
    COMMENT '商品類別';

CREATE TABLE COMMODITY
(
    COM_NO        INT AUTO_INCREMENT COMMENT '商品編號'
        PRIMARY KEY,
    COM_CLASS_NO  INT                                 NOT NULL COMMENT '商品類別編號',
    COM_NAME      VARCHAR(50)                         NOT NULL COMMENT '商品名稱',
    COM_PIC       LONGBLOB COMMENT '商品圖片',
    COM_DEC       VARCHAR(200)                        NULL COMMENT '商品描述',
    COM_PRI       INT                                 NOT NULL,
    COM_QUA       INT                                 NOT NULL COMMENT '數量',
    COM_STATE   TINYINT   DEFAULT 0                 NOT NULL COMMENT '商品狀態，(0:下架，1:上架中，2:完售)',
    COMMENT_TOTAL INT                                 NOT NULL COMMENT '評論總人數',
    RATING_SUM    INT                                 NOT NULL COMMENT '評論總分',
    UPDATE_TIME   TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL ON UPDATE CURRENT_TIMESTAMP COMMENT '更新時間',
    CONSTRAINT COMMODITY_COMMODITY_CLASS_COM_CLASS_NO_FK
        FOREIGN KEY (COM_CLASS_NO) REFERENCES DIYLA.COMMODITY_CLASS (COM_CLASS_NO)
)
    COMMENT '商店商品';


CREATE TABLE COMMODITY_ORDER
(
    ORDER_NO       INT AUTO_INCREMENT COMMENT '訂單編號'
        PRIMARY KEY,
    MEM_ID         INT                                 NOT NULL COMMENT '會員編號',
    ORDER_TIME     TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL COMMENT '下訂時間',
    ORDER_STATUS   TINYINT   DEFAULT 1                 NOT NULL COMMENT '訂單狀態，(0:已結帳，1:未結帳，2:備貨中，3:已完成)',
    ORDER_PRICE    INT COMMENT '訂單原始金額',
    DISCOUNT_PRICE INT                                 NOT NULL COMMENT '訂單折扣金額',
    ACTUAL_PRICE   INT                                 NOT NULL COMMENT '訂單實付金額',
    UPDATE_TIME    TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL ON UPDATE CURRENT_TIMESTAMP COMMENT '更新時間',
    CONSTRAINT COMMODITY_ORDER_MEMBER_MEM_ID_FK
        FOREIGN KEY (MEM_ID) REFERENCES DIYLA.MEMBER (MEM_ID)
)
    COMMENT '商品訂單';


CREATE TABLE COMMODITY_ORDER_DETAIL
(
    ORDER_NO     INT NOT NULL COMMENT '訂單編號',
    COM_NO       INT NOT NULL COMMENT '商品編號',
    COM_QUANTITY INT NOT NULL COMMENT '商品購買數量',
    COM_PRICE    INT NOT NULL COMMENT '商品購買價格',
    PRIMARY KEY (ORDER_NO, COM_NO),
    CONSTRAINT COMMODITY_ORDER_DETAIL_COMMODITY_COM_NO_FK
        FOREIGN KEY (COM_NO) REFERENCES DIYLA.COMMODITY (COM_NO),
    CONSTRAINT COMMODITY_ORDER_DETAIL_COMMODITY_ORDER_ORDER_NO_FK
        FOREIGN KEY (ORDER_NO) REFERENCES DIYLA.COMMODITY_ORDER (ORDER_NO)
)
    COMMENT '商品訂單明細';

CREATE TABLE COMMODITY_TRACK
(
    MEM_ID INT NOT NULL COMMENT '會員編號',
    COM_NO INT NOT NULL COMMENT '商品編號',
    PRIMARY KEY (COM_NO, MEM_ID),
    CONSTRAINT COMMODITY_TRACK_COMMODITY_COM_NO_FK
        FOREIGN KEY (COM_NO) REFERENCES DIYLA.COMMODITY (COM_NO),
    CONSTRAINT COMMODITY_TRACK_MEMBER_MEM_ID_FK
        FOREIGN KEY (MEM_ID) REFERENCES DIYLA.MEMBER (MEM_ID)
)
    COMMENT '追蹤商品';

CREATE TABLE COMMODITY_COMMENT
(
    COM_COMMENT_NO INT AUTO_INCREMENT COMMENT '商品評論編號'
        PRIMARY KEY,
    COM_NO         INT                                 NOT NULL COMMENT '商品編號',
    MEM_ID         INT                                 NOT NULL COMMENT '會員編號',
    RATING         TINYINT   DEFAULT 5                 NOT NULL COMMENT '評分，(1~5分)',
    COM_CONTENT    VARCHAR(200)                        NULL COMMENT '評論內容',
    COM_TIME       TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL ON UPDATE CURRENT_TIMESTAMP COMMENT '評論時間',
    CONSTRAINT COMMODITY_COMMENT_COMMODITY_COM_NO_FK
        FOREIGN KEY (COM_NO) REFERENCES DIYLA.COMMODITY (COM_NO),
    CONSTRAINT COMMODITY_COMMENT_MEMBER_MEM_ID_FK
        FOREIGN KEY (MEM_ID) REFERENCES DIYLA.MEMBER (MEM_ID)
)
    COMMENT '商品評論';

CREATE TABLE SHOPPING_CART_LIST
(
    MEM_ID     INT NOT NULL COMMENT '會員編號',
    COM_NO     INT NOT NULL COMMENT '商品編號',
    COM_AMOUNT INT NOT NULL COMMENT '商品數量',
    CONSTRAINT SHOPPING_CART_LIST_COMMODITY_COM_NO_FK
        FOREIGN KEY (COM_NO) REFERENCES DIYLA.COMMODITY (COM_NO),
    CONSTRAINT SHOPPING_CART_LIST_MEMBER_MEM_ID_FK
        FOREIGN KEY (MEM_ID) REFERENCES DIYLA.MEMBER (MEM_ID)
)
    COMMENT '購物車清單';







